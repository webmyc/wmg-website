---
// Hero component with video background, noise animation, and organic load animations
import AudioToggle from './AudioToggle.astro';
---

<section class="hero relative overflow-hidden">
  <div class="hero__media">
    <video 
      autoplay 
      muted 
      loop 
      playsinline
      class="hero__vid"
      poster="/hero/hero-1920.jpg"
      preload="metadata"
    >
      <source src="/video/hero-bg.mp4" type="video/mp4">
      <!-- Fallback image -->
      <img 
        src="/hero/hero-1920.jpg" 
        alt="The Whole Men Gathering background" 
        class="w-full h-full object-cover"
        loading="eager"
      />
    </video>
    <div class="hero__noise" aria-hidden="true"></div>
  </div>
    
    <!-- Dark gradient overlay for text readability -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/60 to-black/80"></div>
    
    <!-- Subtle vignette effect -->
    <div class="absolute inset-0 bg-radial-gradient from-transparent via-transparent to-black/30"></div>
    
    <!-- Animated gradient flares -->
    <div class="absolute inset-0">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-radial from-wmg-gold/10 via-wmg-gold/5 to-transparent rounded-full blur-3xl animate-float"></div>
      <div class="absolute bottom-1/3 right-1/4 w-80 h-80 bg-gradient-radial from-wmg-gold/8 via-wmg-gold/3 to-transparent rounded-full blur-3xl animate-float-delayed"></div>
      <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-radial from-wmg-gold/6 via-wmg-gold/2 to-transparent rounded-full blur-2xl animate-float-slow"></div>
    </div>
    
    <!-- Noise overlay -->
    <div class="absolute inset-0 opacity-[0.03] bg-noise-pattern"></div>
  </div>

  <!-- Content overlay -->
  <div class="hero__content">
    <img 
      src="/logo.png" 
      alt="The Whole Men Gathering Logo" 
      class="hero__logo" 
      loading="eager" 
      width="400" 
      height="400"
      decoding="sync"
      fetchpriority="high"
    />

        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-wmg-text mb-2 sm:mb-3 md:mb-4 leading-tight hero-title">
          The Whole Men Gathering
        </h1>
        
        <p class="text-sm sm:text-base md:text-lg lg:text-xl xl:text-2xl text-wmg-text mb-3 sm:mb-4 md:mb-6 max-w-4xl mx-auto leading-relaxed hero-subtitle px-2">
          Weaving together ancient, contemporary and emergent wisdom approaches for a manhood rooted in service to the whole.
        </p>
        
        <p class="text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl text-wmg-text/90 mb-4 sm:mb-6 md:mb-8 max-w-3xl mx-auto leading-relaxed hero-description px-2">
          We invite you to take part into a global community based on the Gene Keys Noble Code, open to all Men no matter the level of experience of the Gene Keys.
        </p>
        
        <a 
          href="#signup" 
          id="hero-cta"
          class="inline-block bg-wmg-gold text-wmg-bg px-4 sm:px-6 md:px-8 py-2 sm:py-3 md:py-4 text-sm sm:text-base md:text-lg font-semibold rounded-lg hover:bg-wmg-gold/90 focus:outline-none focus:ring-4 focus:ring-wmg-gold/50 transition-all duration-300 transform hover:scale-105 hero-cta min-h-[40px] sm:min-h-[44px] flex items-center justify-center"
        >
          Join the Gathering
        </a>
      </div>
  
      <!-- Audio Toggle -->
      <AudioToggle />
      
      <!-- Video Credit -->
      <div class="absolute bottom-4 right-4 sm:bottom-6 sm:right-6 z-20">
        <a 
          href="https://www.pexels.com/video/a-flame-of-a-burning-firewoods-5596906/" 
          target="_blank" 
          rel="noopener noreferrer"
          class="text-wmg-text/40 text-xs sm:text-sm hover:text-wmg-text/60 transition-colors duration-200"
        >
          Video by Kelly
        </a>
      </div>
    </section>

<style>
  .hero {
    min-height: 100vh;
  }
  
  .hero__media {
    position: absolute; 
    inset: 0; 
    overflow: hidden;
    transform: translateZ(0); /* Force hardware acceleration */
  }
  
  .hero__vid {
    width: 100%; 
    height: 100%; 
    object-fit: cover;
    animation: kenburns 20s ease-in-out infinite alternate;
    filter: brightness(.88) contrast(1.05) saturate(1.05);
    will-change: transform;
  }
  
  @keyframes kenburns {
    0% { 
      transform: scale(1.02) translate3d(0, 0, 0) rotate(0deg); 
    }
    50% { 
      transform: scale(1.08) translate3d(1px, -1px, 0) rotate(0.2deg); 
    }
    100% { 
      transform: scale(1.12) translate3d(2px, 1px, 0) rotate(-0.1deg); 
    }
  }
  
  .hero__noise {
    position: absolute; 
    inset: 0;
    background-image: 
      radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0),
      radial-gradient(circle at 3px 3px, rgba(255,255,255,0.1) 1px, transparent 0);
    background-size: 20px 20px, 30px 30px;
    opacity: .08; 
    mix-blend-mode: overlay; 
    pointer-events: none;
    animation: grain 8s steps(8) infinite;
  }
  
  @keyframes grain {
    0%, 100% { 
      transform: translate(0, 0) scale(1); 
      opacity: .08;
    }
    25% { 
      transform: translate(-5px, 3px) scale(1.01); 
      opacity: .06;
    }
    50% { 
      transform: translate(3px, -4px) scale(0.99); 
      opacity: .1;
    }
    75% { 
      transform: translate(-2px, 2px) scale(1.005); 
      opacity: .07;
    }
  }

  .hero__content {
    position: relative; 
    z-index: 2; 
    display: grid; 
    place-items: center; 
    text-align: center;
    padding: clamp(4rem, 8vh, 8rem) 1.25rem; 
    gap: 1.25rem;
  }
  
  .hero__logo {
    width: clamp(240px, 30vw, 400px); 
    height: auto;
    filter: drop-shadow(0 0 15px rgba(0, 0, 0, .4));
    animation: logoPulse 6s ease-in-out infinite;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: high-quality;
  }
  
  @keyframes logoPulse {
    0%, 100% { 
      transform: scale(1); 
      opacity: 1; 
      filter: drop-shadow(0 0 10px rgba(0, 0, 0, .35));
    }
    50% { 
      transform: scale(1.03); 
      opacity: .95; 
      filter: drop-shadow(0 0 15px rgba(212, 175, 55, .3));
    }
  }

  /* Organic hero animations */
  .hero__logo {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    animation: heroLogoReveal 1s ease-out 0.1s forwards, logoPulse 4s ease-in-out infinite 2s;
  }

      .hero-title {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
        animation: heroTitleReveal 1.2s ease-out 0.3s forwards;
      }
  
  .hero-subtitle {
    opacity: 0;
    transform: translateY(20px);
    animation: heroSubtitleReveal 1s ease-out 0.8s forwards;
  }
  
  .hero-description {
    opacity: 0;
    transform: translateY(20px);
    animation: heroDescriptionReveal 1s ease-out 1.2s forwards;
  }
  
  .hero-cta {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    animation: heroCTAReveal 0.8s ease-out 1.6s forwards;
  }
  
      @keyframes heroLogoReveal {
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes heroTitleReveal {
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
  
  @keyframes heroSubtitleReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes heroDescriptionReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes heroCTAReveal {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Radial gradient utility */
  .bg-radial-gradient {
    background: radial-gradient(circle at center, var(--tw-gradient-stops));
  }
  
  /* Gradient radial utility */
  .bg-gradient-radial {
    background: radial-gradient(circle at center, var(--tw-gradient-stops));
  }
  
  /* Noise pattern background */
  .bg-noise-pattern {
    background-image: 
      radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0);
    background-size: 20px 20px;
  }
  
      /* Additional floating animation */
      @keyframes floatSlow {
        0%, 100% {
          transform: translateY(0px) translateX(0px) scale(1);
        }
        25% {
          transform: translateY(-15px) translateX(8px) scale(1.02);
        }
        50% {
          transform: translateY(-8px) translateX(-5px) scale(0.98);
        }
        75% {
          transform: translateY(12px) translateX(3px) scale(1.01);
        }
      }

      .animate-float-slow {
        animation: floatSlow 12s ease-in-out infinite;
      }

      /* Logo glow effect */
      .logo-glow {
        filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.3)) drop-shadow(0 0 40px rgba(212, 175, 55, 0.15));
        background: transparent !important;
      }

      .logo-glow:hover {
        filter: drop-shadow(0 0 25px rgba(212, 175, 55, 0.4)) drop-shadow(0 0 50px rgba(212, 175, 55, 0.2));
      }
  
  /* Ensure noise animation respects reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .animate-grain {
      animation: none;
    }
    
        .hero-logo,
        .hero-title,
        .hero-subtitle,
        .hero-description,
        .hero-cta {
          animation: none;
          opacity: 1;
          transform: none;
        }
  }
  
  /* Smooth scroll behavior for anchor links */
  html {
    scroll-behavior: smooth;
  }
  
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>

<script>
  import { trackButtonClick, trackVideoEvent, track } from '../lib/analytics.ts';
  
  document.addEventListener('DOMContentLoaded', function() {
    // Track hero CTA click
    const heroCTA = document.getElementById('hero-cta');
    if (heroCTA) {
      heroCTA.addEventListener('click', () => {
        trackButtonClick('join_gathering', 'hero');
      });
    }
    
    // Track video events
    const heroVideo = document.querySelector('video');
    if (heroVideo) {
      heroVideo.addEventListener('play', () => {
        trackVideoEvent('play', 'hero_background');
      });
      
      heroVideo.addEventListener('pause', () => {
        trackVideoEvent('pause', 'hero_background');
      });
      
      heroVideo.addEventListener('error', () => {
        trackVideoEvent('error', 'hero_background');
      });
    }
    
    // Track section view when hero comes into view
    const heroSection = document.querySelector('section');
    if (heroSection) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            track('section_view', { section: 'hero' });
            observer.disconnect(); // Only track once
          }
        });
      }, { threshold: 0.5 });
      
      observer.observe(heroSection);
    }
  });
</script>
