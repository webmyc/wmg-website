---
// Hero component with video background, noise animation, and organic load animations
import AudioToggle from './AudioToggle.astro';
---

<section class="relative min-h-screen flex items-center justify-center overflow-hidden bg-wmg-bg">
  <!-- Noise overlay SVG -->
  <svg class="absolute inset-0 w-full h-full pointer-events-none opacity-[0.06]" aria-hidden="true">
    <defs>
      <filter id="wmg-noise" x="0%" y="0%" width="100%" height="100%">
        <feTurbulence 
          baseFrequency="0.9" 
          numOctaves="4" 
          stitchTiles="stitch"
          type="fractalNoise"
        />
        <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"/>
      </filter>
    </defs>
    <rect width="100%" height="100%" filter="url(#wmg-noise)" class="animate-grain" />
  </svg>

  <!-- Background video -->
  <div class="absolute inset-0">
    <video 
      autoplay 
      muted 
      loop 
      playsinline
      class="w-full h-full object-cover"
      poster="/hero/hero-1920.jpg"
    >
      <source src="/video/hero-bg.mp4" type="video/mp4">
      <!-- Fallback image -->
      <img 
        src="/hero/hero-1920.jpg" 
        alt="The Whole Men Gathering background" 
        class="w-full h-full object-cover"
        loading="eager"
      />
    </video>
    
    <!-- Dark gradient overlay for text readability -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/60 to-black/80"></div>
    
    <!-- Subtle vignette effect -->
    <div class="absolute inset-0 bg-radial-gradient from-transparent via-transparent to-black/30"></div>
    
    <!-- Animated gradient flares -->
    <div class="absolute inset-0">
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-radial from-wmg-gold/10 via-wmg-gold/5 to-transparent rounded-full blur-3xl animate-float"></div>
      <div class="absolute bottom-1/3 right-1/4 w-80 h-80 bg-gradient-radial from-wmg-gold/8 via-wmg-gold/3 to-transparent rounded-full blur-3xl animate-float-delayed"></div>
      <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-gradient-radial from-wmg-gold/6 via-wmg-gold/2 to-transparent rounded-full blur-2xl animate-float-slow"></div>
    </div>
    
    <!-- Noise overlay -->
    <div class="absolute inset-0 opacity-[0.03] bg-noise-pattern"></div>
  </div>

      <!-- Content overlay -->
      <div class="relative z-10 text-center px-4 sm:px-6 max-w-4xl mx-auto">
        <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-wmg-text mb-4 sm:mb-6 leading-tight hero-title">
          The Whole Men Gathering
        </h1>
        
        <p class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-wmg-text mb-6 sm:mb-8 max-w-3xl mx-auto leading-relaxed hero-subtitle px-2">
          Weaving together ancient, contemporary and emergent wisdom approaches for a manhood rooted in service to the whole.
        </p>
        
        <p class="text-base sm:text-lg md:text-xl text-wmg-text/90 mb-8 sm:mb-10 max-w-2xl mx-auto leading-relaxed hero-description px-2">
          We invite you to take part into a global community based on the Gene Keys Noble Code, open to all Men no matter the level of experience of the Gene Keys.
        </p>
        
        <a 
          href="#signup" 
          id="hero-cta"
          class="inline-block bg-wmg-gold text-wmg-bg px-6 sm:px-8 py-3 sm:py-4 text-base sm:text-lg font-semibold rounded-lg hover:bg-wmg-gold/90 focus:outline-none focus:ring-4 focus:ring-wmg-gold/50 transition-all duration-300 transform hover:scale-105 hero-cta min-h-[44px] flex items-center justify-center"
        >
          Join the Gathering
        </a>
      </div>
  
      <!-- Audio Toggle -->
      <AudioToggle />
      
      <!-- Video Credit -->
      <div class="absolute bottom-4 right-4 sm:bottom-6 sm:right-6 z-20">
        <a 
          href="https://www.pexels.com/video/a-flame-of-a-burning-firewoods-5596906/" 
          target="_blank" 
          rel="noopener noreferrer"
          class="text-wmg-text/40 text-xs sm:text-sm hover:text-wmg-text/60 transition-colors duration-200"
        >
          Video by Kelly
        </a>
      </div>
    </section>

<style>
  /* Organic hero animations */
  .hero-title {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
    animation: heroTitleReveal 1.2s ease-out 0.3s forwards;
  }
  
  .hero-subtitle {
    opacity: 0;
    transform: translateY(20px);
    animation: heroSubtitleReveal 1s ease-out 0.8s forwards;
  }
  
  .hero-description {
    opacity: 0;
    transform: translateY(20px);
    animation: heroDescriptionReveal 1s ease-out 1.2s forwards;
  }
  
  .hero-cta {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
    animation: heroCTAReveal 0.8s ease-out 1.6s forwards;
  }
  
  @keyframes heroTitleReveal {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  @keyframes heroSubtitleReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes heroDescriptionReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes heroCTAReveal {
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Radial gradient utility */
  .bg-radial-gradient {
    background: radial-gradient(circle at center, var(--tw-gradient-stops));
  }
  
  /* Gradient radial utility */
  .bg-gradient-radial {
    background: radial-gradient(circle at center, var(--tw-gradient-stops));
  }
  
  /* Noise pattern background */
  .bg-noise-pattern {
    background-image: 
      radial-gradient(circle at 1px 1px, rgba(255,255,255,0.15) 1px, transparent 0);
    background-size: 20px 20px;
  }
  
  /* Additional floating animation */
  @keyframes floatSlow {
    0%, 100% {
      transform: translateY(0px) translateX(0px) scale(1);
    }
    25% {
      transform: translateY(-15px) translateX(8px) scale(1.02);
    }
    50% {
      transform: translateY(-8px) translateX(-5px) scale(0.98);
    }
    75% {
      transform: translateY(12px) translateX(3px) scale(1.01);
    }
  }
  
  .animate-float-slow {
    animation: floatSlow 12s ease-in-out infinite;
  }
  
  /* Ensure noise animation respects reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .animate-grain {
      animation: none;
    }
    
    .hero-title,
    .hero-subtitle,
    .hero-description,
    .hero-cta {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
  
  /* Smooth scroll behavior for anchor links */
  html {
    scroll-behavior: smooth;
  }
  
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>

<script>
  import { trackButtonClick, trackVideoEvent } from '../lib/analytics.ts';
  
  document.addEventListener('DOMContentLoaded', function() {
    // Track hero CTA click
    const heroCTA = document.getElementById('hero-cta');
    if (heroCTA) {
      heroCTA.addEventListener('click', () => {
        trackButtonClick('join_gathering', 'hero');
      });
    }
    
    // Track video events
    const heroVideo = document.querySelector('video');
    if (heroVideo) {
      heroVideo.addEventListener('play', () => {
        trackVideoEvent('play', 'hero_background');
      });
      
      heroVideo.addEventListener('pause', () => {
        trackVideoEvent('pause', 'hero_background');
      });
      
      heroVideo.addEventListener('error', () => {
        trackVideoEvent('error', 'hero_background');
      });
    }
    
    // Track section view when hero comes into view
    const heroSection = document.querySelector('section');
    if (heroSection) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            track('section_view', { section: 'hero' });
            observer.disconnect(); // Only track once
          }
        });
      }, { threshold: 0.5 });
      
      observer.observe(heroSection);
    }
  });
</script>
